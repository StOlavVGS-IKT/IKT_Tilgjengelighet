<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Endre status</title>
<style>
  body { margin:0; padding:28px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; background:#f6f7f9; }
  h2 { text-align:center; margin:0 0 20px; }
  .row { display:flex; flex-direction:column; gap:16px; }
  button {
    width:100%; padding:24px; font-size:24px; border:0; border-radius:14px; color:#fff;
    box-shadow:0 6px 16px rgba(0,0,0,.12); cursor:pointer; transition:transform .05s ease;
  }
  button:active { transform:scale(0.98); }
  .green{ background:#22C55E; } .orange{ background:#F59E0B; } .blue{ background:#3B82F6; }
  .card { margin-top:18px; padding:14px; background:#fff; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.06); }
  input, .token { width:100%; padding:10px 12px; font-size:16px; border-radius:8px; border:1px solid #d0d7de; }
  .hint { color:#666; font-size:13px; margin-top:6px;}
  .status { text-align:center; margin-top:16px; color:#333; }
</style>
</head>
<body>
<h2>Endre status</h2>
<div class="row">
  <button class="green" onclick="setStatus('Tilgjengelig')">ðŸŸ¢ Tilgjengelig</button>
  <button class="orange" onclick="setStatus('MÃ¸te')">ðŸŸ  MÃ¸te</button>
  <button class="blue" onclick="setStatus('Ute pÃ¥ oppdrag')">ðŸ”µ Ute pÃ¥ oppdrag</button>
</div>

<div class="card">
  <label for="tok">Valgfritt sikkerhetstoken</label>
  <input id="tok" placeholder="Lim inn token hvis aktivert i serveren (AUTH_TOKEN)">
  <div class="hint">Lagrer lokalt pÃ¥ denne enheten og sendes som Bearerâ€‘token ved endring.</div>
</div>

<div class="status">
  <div>NÃ¥vÃ¦rende status: <strong id="cur">â€”</strong></div>
  <div>/Ã…pne visning</a></div>
</div>

<script>
const tok = document.getElementById('tok');
const cur = document.getElementById('cur');

tok.value = localStorage.getItem('status_token') || '';
tok.addEventListener('change', ()=> localStorage.setItem('status_token', tok.value));

async function refresh(){
  const r = await fetch('/api/status', {cache:'no-store'});
  const j = await r.json();
  cur.textContent = j.status;
}

async function setStatus(s){
  const headers = { 'Content-Type':'application/json' };
  const t = tok.value.trim();
  if(t) headers['Authorization'] = 'Bearer ' + t;
  const r = await fetch('/set', { method:'POST', headers, body: JSON.stringify({status:s}) });
  if(r.status === 401){ alert('Uautorisert (mangler/feil token)'); return; }
  if(!r.ok){
    const j = await r.json().catch(()=>({}));
    alert('Feil: ' + (j.error || r.statusText));
    return;
  }
  await refresh();
  alert('Status oppdatert: ' + s);
}
refresh();
setInterval(refresh, 5000);
</script>
</body>
</html>
